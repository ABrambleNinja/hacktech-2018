<html>
    <head>
        <title>SAD</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    </head>
    <body>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <p id="mapholder">
            Below are the list of games people around you are active in!
        </p>
        <p id="game1"> Game 1
        </p><p id="game2"> Game 2
        </p><p id="game3"> Game 3
        </p><p id="game4"> Game 4
        </p><p id="game5"> Game 5
        </p><p id="game6"> Game 6
        </p><p id="game7"> Game 7
        </p><p id="game8"> Game 8
        </p><p id="game9"> Game 9
        </p><p id="game10"> Game 10
        </p>
        <script>
            var games = {{ filteredGames }};
            var arrayLength = games.length;
            for (var i = 0; i < arrayLength; i++) {
                    displayGame(games[i])
                }


            function displayGame(gameID,i){
                document.getElementById("game"+i).innerHTML = "/game/"+gameID
                }


            var outputgames = document.getElementById("gps");
            function getLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(showPosition);
                    navigator.geolocation.getCurrentPosition(showMap);
                    navigator.geolocation.getCurrentPosition(sendPosition);
                } else {
                    outputgames.innerHTML = "Geolocation is not supported by this browser.";
                }
            }
            function showPosition(position) {
                outputgames.innerHTML = "Latitude: " + position.coords.latitude +
                "<br>Longitude: " + position.coords.longitude;
            }

            function showMap(position) {
                var latlon = position.coords.latitude + "," + position.coords.longitude;
                var img_url = "https://maps.googleapis.com/maps/api/staticmap?center="+latlon+"&zoom=14&size=400x300&sensor=false&key=AIzaSyCUa7DrgBVZwYBVJOFrpjauc7DQ64h9D_Y";
                document.getElementById("mapholder").innerHTML = "<img src='"+img_url+"'>" + "<br/> Searching for players... within a few miles";
            }

            function sendPosition(position){
                /*
                var http = new XMLHttpRequest();
                var url = "198.199.94.88:5000/gpsdata";
                var params = 'lat=' +position.coords.latitude+'&amp;lon='+position.coords.longitude
                http.open("POST", url, true);
                http.send(params);
                */
                $.ajax({
                    type : "POST",
                    url : "http://127.0.0.1:5000/gpsdata",
                    data: JSON.stringify(position.coords),
                    contentType: 'application/json;charset=UTF-8',
                    success: function(result) {
                        console.log(result);
                    }
                }
            );
            console.log(position.coords.latitude);
            console.log(position.coords.longitude)
            }

        </script>
    </body>
</html>