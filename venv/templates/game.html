<html>
    <head>
        <title>SAD</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    </head>
    <body>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <script>
                window.onload = function() {
                    startTimer();
                }
                function startTimer() {
                    counter = parseInt(document.getElementById('timer').getAttribute("initial_value"));
                    setInterval(function() {
                        if (counter > 0) {
                            counter--;
                            if (counter == 0) {
                                gameOver();
                            }
                        }
                        $('#timer').html(counter + " Seconds");
                    }, 1000);
                }
                function gameOver() {
                    gameID = document.getElementById("game_id").getAttribute("value");
                    $.ajax({
                        type : "POST",
                        url : "/checkGameOver",
                        data: JSON.stringify(gameID),
                        dataType: 'json',
                        contentType: 'application/json;charset=UTF-8',
                        success: function(result) {
                            console.log(result);
                            if (result == "Win") {
                                console.log("The People Win!");
                            } else if (result == "Loss") {
                                console.log("The Spies Win!");
                            }
                        }
                    });
                }
            </script>
        <h1>
            <span id="game_id" value="{{ gameID }}"> </span>
            This is game {{ gameID }}.
            <br>
            {% if numPlayers == 1 %}
                There is {{ numPlayers }} player in this game out of {{ maxPlayers }}.
            {% else %}
                There are {{ numPlayers }} players in this game out of {{ maxPlayers }}.
            {% endif %}
                <br>
            Your role is {{ role }}.
            {% if location != "UNKNOWN" %}
                The location is {{ location }}.
            {% endif %}
            <br>
            {% if time != 0 %}
                <span id="timer" initial_value="{{ time }}"></span>
            {% endif %}
            <br>
            Enter Your Guess <input type="text">
            <button>Confirm </button>
        </h1>
        <p id="gps">Latitude: ??? <br/>
            Longitude: ???
        </p>
          <button onclick="getLocation()">Get Location</button>
         <p id="mapholder">
            This is a placeholder for the badass goddamn map that will appear here
        </p>
    </body>
    <script>
        var x = document.getElementById("gps");
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
                navigator.geolocation.getCurrentPosition(showMap);
                navigator.geolocation.getCurrentPosition(sendPosition);
            } else {
                x.innerHTML = "Geolocation is not supported by this browser.";
            }
        }
        function showPosition(position) {
            x.innerHTML = "Latitude: " + position.coords.latitude +
            "<br>Longitude: " + position.coords.longitude;
        }

        function showMap(position) {
            var latlon = position.coords.latitude + "," + position.coords.longitude;
            var img_url = "https://maps.googleapis.com/maps/api/staticmap?center="+latlon+"&zoom=14&size=400x300&sensor=false&key=AIzaSyCUa7DrgBVZwYBVJOFrpjauc7DQ64h9D_Y";
            document.getElementById("mapholder").innerHTML = "<img src='"+img_url+"'>" + "<br/> Searching for players... within a few miles";
        }

        function sendPosition(position){
            /*
            var http = new XMLHttpRequest();
            var url = "198.199.94.88:5000/gpsdata";
            var params = 'lat=' +position.coords.latitude+'&amp;lon='+position.coords.longitude
            http.open("POST", url, true);
            http.send(params);
            */
            $.ajax({
                type : "POST",
                url : "http://127.0.0.1:5000/gpsdata",
                data: JSON.stringify(position.coords),
                contentType: 'application/json;charset=UTF-8',
                success: function(result) {
                    console.log(result);
                }
            }
        );
        console.log(position.coords.latitude);
        console.log(position.coords.longitude)
        }

    </script>
</html>>